define(["require","exports","./Game"],function(o,e,t){"use strict";var r;return function(o){function e(o){v=document.getElementById(o),v.addEventListener("touchstart",r,!1),v.addEventListener("touchmove",s,!1),v.addEventListener("touchend",n,!1),c(0),i()}function r(o){if(1===o.targetTouches.length){var e=o.targetTouches[0];C=e.pageX,m=e.pageY}}function n(o){u(k)}function s(o){if(1===o.targetTouches.length){var e=o.targetTouches[0],t=e.pageX,r=e.pageY,n=t-C,s=Math.abs(n),a=r-m;s>=Math.abs(a)?n>100?k="right":n<-100&&(k="left"):a>100?k="down":a<-100&&(k="up")}}function a(){document.getElementById("sb_c").innerText="0",i()}function l(o){var e=localStorage.getItem("highScore");return e||localStorage.setItem("highScore",o.toString()),e&&o>parseInt(e)&&localStorage.setItem("highScore",o.toString()),localStorage.getItem("highScore")}function i(){w=[],w.push(g(0,0)),w.push(g(0,1)),w.push(g(0,3)),b=0,d()}function c(o){b+=o;var e=document.getElementById("sb_c"),t=document.getElementById("sb_h");e.innerText=b.toString();var r=l(b);t.innerText=r}function d(){for(;v.hasChildNodes();)v.removeChild(v.lastChild);w.forEach(function(o,e){o.render(v)})}function f(o){var e=w.filter(function(e){return e.hasCordinates(o)});return e.length>0?e[0]:null}function g(o,e){for(var r=null!==o&&o>=0?o:Math.floor(Math.random()*p),n=null!==e&&e>=0?e:Math.floor(Math.random()*p);f({col:r,row:n});)var r=null!==o&&o>=0?o:Math.floor(Math.random()*p),n=null!==e&&e>=0?e:Math.floor(Math.random()*p);return new t.Tile({col:r,row:n})}function h(){w.forEach(function(o){var e=o.process();e&&e.then(function(e){c(e),w.splice(w.indexOf(o),1)})})}function u(o){switch(o){case"up":for(var e=0,t=1;t<p;t++){var r=w.filter(function(o){return o.Cordinates.row===t});r.length&&console.log("found %s tile(s) in %s row",r.length,t),r.forEach(function(o){console.log("selected tile (%s,%s)",o.Cordinates.col,o.Cordinates.row);for(var t=o.Cordinates.row;t>0;){t--,console.log("\ttrying at (%s,%s)",o.Cordinates.col,t);var r=f({col:o.Cordinates.col,row:t});if(r){if(r.canMerge(o)){var n=r.getGhostCordinates();console.log("\tmerged at (%s,%s)",n.col,n.row),o.setGhostOfTile(r),e++;break}if(r.IsGhost){var s=r.getGhostCordinates();o.setGhostOfCordinates({col:s.col,row:s.row+1}),console.log("\tmove at (%s,%s)",s.col,s.row+1),e++;break}console.log("\tnot moving here");break}e++,o.setGhostOfCordinates({col:o.Cordinates.col,row:t})}var n=o.getGhostCordinates();console.log("\tendded at (%s,%s)",n.col,n.row)})}if(e>0){h();var n=g(null,p-1);w.push(n),n.render(v)}break;case"down":for(var e=0,t=p-2;t>=0;t--){var r=w.filter(function(o){return o.Cordinates.row===t});r.length&&console.log("found %s tile(s) in %s row",r.length,t),r.forEach(function(o){console.log("selected tile (%s,%s)",o.Cordinates.col,o.Cordinates.row);for(var t=o.Cordinates.row;t<p-1;){t++,console.log("\ttrying at (%s,%s)",o.Cordinates.col,t);var r=f({col:o.Cordinates.col,row:t});if(r){if(r.canMerge(o)){var n=r.getGhostCordinates();console.log("\tmerged at (%s,%s)",n.col,n.row),o.setGhostOfTile(r),e++;break}if(r.IsGhost){var s=r.getGhostCordinates();o.setGhostOfCordinates({col:s.col,row:s.row-1}),console.log("\tmove at (%s,%s)",s.col,s.row-1),e++;break}console.log("\tnot moving here");break}e++,o.setGhostOfCordinates({col:o.Cordinates.col,row:t})}var n=o.getGhostCordinates();console.log("\tendded at (%s,%s)",n.col,n.row)})}if(e>0){h();var n=g(null,0);w.push(n),n.render(v)}break;case"left":for(var e=0,s=1;s<p;s++){var r=w.filter(function(o){return o.Cordinates.col===s});r.length&&console.log("found %s tile(s) in %s col",r.length,s),r.forEach(function(o){console.log("selected tile (%s,%s)",o.Cordinates.col,o.Cordinates.row);for(var t=o.Cordinates.col;t>0;){t--,console.log("\ttrying at (%s,%s)",t,o.Cordinates.row);var r=f({col:t,row:o.Cordinates.row});if(r){if(r.canMerge(o)){var n=r.getGhostCordinates();console.log("\tmerged at (%s,%s)",n.col,n.row),o.setGhostOfTile(r),e++;break}if(r.IsGhost){var s=r.getGhostCordinates();o.setGhostOfCordinates({col:s.col+1,row:s.row}),console.log("\tmove at (%s,%s)",s.col+1,s.row),e++;break}console.log("\tnot moving here");break}e++,o.setGhostOfCordinates({col:t,row:o.Cordinates.row})}var n=o.getGhostCordinates();console.log("\tendded at (%s,%s)",n.col,n.row)})}if(e>0){h();var n=g(p-1,null);w.push(n),n.render(v)}break;case"right":for(var e=0,s=p-2;s>=0;s--){var r=w.filter(function(o){return o.Cordinates.col===s});r.length&&console.log("found %s tile(s) in %s col",r.length,s),r.forEach(function(o){console.log("selected tile (%s,%s)",o.Cordinates.col,o.Cordinates.row);for(var t=o.Cordinates.col;t<p-1;){t++,console.log("\ttrying at (%s,%s)",t,o.Cordinates.row);var r=f({col:t,row:o.Cordinates.row});if(r){if(r.canMerge(o)){var n=r.getGhostCordinates();console.log("\tmerged at (%s,%s)",n.col,n.row),o.setGhostOfTile(r),e++;break}if(r.IsGhost){var s=r.getGhostCordinates();o.setGhostOfCordinates({col:s.col-1,row:s.row}),console.log("\tmove at (%s,%s)",s.col-1,s.row),e++;break}console.log("\tnot moving here");break}e++,o.setGhostOfCordinates({col:t,row:o.Cordinates.row})}var n=o.getGhostCordinates();console.log("\tendded at (%s,%s)",n.col,n.row)})}if(e>0){h();var n=g(0,null);w.push(n),n.render(v)}}w=w.filter(function(o){return!o.IsMerged}),w.forEach(function(o){o.cleanUp()})}var v,w,C,m,G,p=4,b=0,k="";!function(o){o[o.left=37]="left",o[o.right=39]="right",o[o.up=38]="up",o[o.down=40]="down"}(G||(G={}));var E;!function(o){o[o.left=100]="left",o[o.right=102]="right",o[o.up=104]="up",o[o.down=98]="down"}(E||(E={})),o.Start=e,o.reset=a,document.addEventListener("keydown",function(o){u(G[o.keyCode]||E[o.keyCode])})}(r||(r={})),r});